{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "51eebcad",
   "metadata": {},
   "source": [
    "# Hiver 2024 - Travail pratique 2\n",
    "\n",
    "Remise électronique sur ZoneCours au plus tard le **10 avril à 23h55** de:\n",
    "\n",
    "* Ce Jupyter notebook (.ipynb) en guise de rapport, une fois les réponses ajoutées. \n",
    "* **Tous** les fichiers *.py* nécessaires pour l'exécution du notebook\n",
    "\n",
    "Le rapport **doit**:\n",
    "\n",
    "* être en format .ipynb (des points seront enlevés pour tout autre format).\n",
    "* inclure le numéro de matricule de tous les membres de l'équipe dans la première cellule (i.e. remplacez ces consignes)\n",
    "* répondre aux questions et discuter des résultats à l'aide de tables, graphiques, et cellules markdown\n",
    "\n",
    "Barème:\n",
    "\n",
    "* **40%** Exactitude des résultats\n",
    "* **25%** Discussions complètes et **concises** (cellules ``markdown'')\n",
    "* **20%** Concision du notebook (.ipynb avec minimum de code) et clarté des graphiques\n",
    "* **15%** Clarté du code (.py)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "3e7104d3",
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy as np"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1b35088a",
   "metadata": {},
   "source": [
    "# Question 1\n",
    "\n",
    "En vous inspirant du notebook 'ngarch_estimation.ipynb', estimez séquentiellement les paramètres d'un modèle **AGARCH** du 20 juillet, 2018, au 20 juillet 2023. Utilisez le même jeu de données. Notez que ces paramètres sont estimés sur les rendements excédentaires de l'indice de marché. Pourquoi est-il préférable de procéder ainsi? \n",
    "\n",
    "Représentez l'évolution des paramètres du modèle sur cette période en utilisant la fonction `plot_parameter_series(model, estimates)`, que vous adapterez au besoin. \n",
    "\n",
    "Discutez des aspects les plus marquants de ces différentes dynamiques et des moments qu'ils impliques."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "64261ac9",
   "metadata": {},
   "source": [
    "# Question 2\n",
    "\n",
    "En itérant sur les paramètres trouvés en Question 1, calculez à chaque jour ouvrable les prix des options européennes suivantes sur l'indice:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "d603f157",
   "metadata": {},
   "outputs": [],
   "source": [
    "F = 100 # On normalise le prix forward à 100 chaque jour\n",
    "K = np.arange(80,121,2.5)\n",
    "T = 1/12\n",
    "mny = K / F # La définition de moneyness à utiliser\n",
    "is_call = mny >= 1"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "61d340fb",
   "metadata": {},
   "source": [
    "Le taux sans risque doit être mis à jour quotidiennement à même le jeu de données utilisé. Le prix peut être obtenu par simulation, où à l'aide de la formule quasi-analytique. Si vous procédez par simulation, utilisez un nombre pair de simulations aussi grand que raisonnablement possible, avec des variables antithétiques.\n",
    "\n",
    "Vous trouverez ensuite, pour chacune des options, la volatilité implicite (BMS) correspondant au prix obtenu à l'aide du AGARCH. À chaque jour, calculez `IV_atm`, le niveau de volatilité implicite de l'option à la monnaie (`mny == 1`), la pente `slope = IV(1.0) - IV(0.8)`, où `IV(mny)` représente la volatilité implicite de l'option de degré d'enjeu `mny`. \n",
    "\n",
    "Présentez dans une figure 1x2 (lignes x colonnes) la dynamique temporelle de ces deux séries. Discutez de leur évolution et de leur correlation l'une avec l'autre, et aussi avec les séries de paramètres."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b73b3519",
   "metadata": {},
   "source": [
    "# Question 3\n",
    "\n",
    "Trouvez les dates auxquelles `IV_atm` atteint sa valeur minimum et sa valeur maximum. En excluant ces deux dates, trouvez les dates auxquelles `slope` atteint sa valeur minimum et sa valeur maximum.\n",
    "\n",
    "Dans une figure 2x2, présentez le smile que vous avez obtenu sur ces quatres dates. Discutez de ces figures en établissant des liens avec votre réponse à la Question 2. \n",
    "\n",
    "## Bonus\n",
    "\n",
    "Dans une autre figure 2x2, rapportez les *prix* obtenus par **simulation** pour ces quatres dates, accompagnés de leur intervalle de confiance. Normalisez le tout par le prix de chacune des options tel qu'obtenu à l'aide de la **formule quasi-analytique**. Les intervalles de confiance normalisés incluent-ils systématiquement la valeur 1.0? Discutez de vos résultats."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e11de721",
   "metadata": {},
   "source": [
    "# Question 4\n",
    "\n",
    "Chaque jour, appliquez la formule du VIX sur les prix d'options obtenus pour obtenir un indice que nous appelerons le MVIX ('model VIX'). Dans une même figure 1x1, rapportez l'évolution du VIX (que vous téléchargerez du site du Cboe), du MVIX et celle de $h_{t+1}$. Comparez les trois séries et discuter des sources potentielles de divergences."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "28f9d845",
   "metadata": {},
   "source": [
    "# Question 5\n",
    "\n",
    "À tous les 21 jours ouvrables (`np.arange(0, len(data.index), 21)`), vous prenez une position longue sur un swap de variance. À l'aide du VIX (Cboe) et de la variance réalisée (selon le AGARCH) sur le mois qui suit, calculez le PnL de votre position. Tracez cette la série temporelle de vos PnL. Discutez de la série et de ses 4 premiers moments."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.18"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
